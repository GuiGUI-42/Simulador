<!DOCTYPE html>
<html>
<head>
    <title>Simulador de Controle</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>
    <style>
        body { font-family: sans-serif; }
        label { display: block; margin-top: 8px; }
    </style>
</head>
<body>
    <h1>üõ†Ô∏è Simulador de Controle (Flask)</h1>

    <label>Tipo:</label>
    <select id="tipo" onchange="atualizarCampos()">
        <option value="Caso 1">Caso 1</option>
        <option value="Caso 2">Caso 2</option>
    </select>

    <div id="caso1" style="display: none;">
        <label>Polo:</label>
        <input type="number" id="p1_1" value="-1">
        <label>Zero:</label>
        <input type="number" id="z_1" value="0">
    </div>

    <div id="caso2" style="display: none;">
        <label>Polo 1:</label>
        <input type="number" id="p1_2" value="-1">
        <label>Polo 2:</label>
        <input type="number" id="p2_2" value="-2">
        <label>Zero:</label>
        <input type="number" id="z_2" value="0">
    </div>

    <h3>Fun√ß√£o de Transfer√™ncia</h3>
    <div id="funcao" style="font-size: 1.2em; background: #eee; padding: 10px;"></div>

    <h3>Gr√°fico</h3>
    <img id="plot" src="" style="max-width: 100%; border: 1px solid #ccc;">

    <script>
        async function atualizar() {
            const tipo = document.getElementById("tipo").value;
            const data = {
                tipo,
                p1_1: document.getElementById("p1_1")?.value,
                z_1: document.getElementById("z_1")?.value,
                p1_2: document.getElementById("p1_2")?.value,
                p2_2: document.getElementById("p2_2")?.value,
                z_2: document.getElementById("z_2")?.value
            };
    
            const res = await fetch('/atualizar', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
    
            const json = await res.json();
    
            // Atualiza fun√ß√£o de transfer√™ncia
            document.getElementById("funcao").innerHTML = json.latex_funcao;
            if (window.MathJax) MathJax.typesetPromise();
    
            // Atualiza gr√°fico com cache busting
            const img = document.getElementById("plot");
            img.src = json.plot_url
            
        }
    
        function atualizarCampos() {
            const tipo = document.getElementById("tipo").value;
            document.getElementById("caso1").style.display = tipo === "Caso 1" ? "block" : "none";
            document.getElementById("caso2").style.display = tipo === "Caso 2" ? "block" : "none";
            atualizar();
        }
    
        window.onload = () => {
            atualizarCampos();
    
            // Aqui est√° o segredo: escuta os inputs
            document.querySelectorAll("input").forEach(input => {
                input.addEventListener("input", atualizar);
            });
           
        };
    </script>
    
</body>
</html>
