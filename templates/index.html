<!DOCTYPE html>
<html>
<head>
    <title>Simulador de Controle</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
    </script>
    <style>
        body { font-family: sans-serif; }
        .header { background: #f4f4f4; padding: 10px; text-align: center; }
        label { display: block; margin-top: 8px; }
        .section { margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="header">
        <a href="/">P√°gina Principal</a> | <a href="/pagina2">P√°gina 2</a>| <a href="/pagina3">P√°gina 3</a>
    </div>

    <h1>üõ†Ô∏è Simulador de Controle (Flask)</h1>

    <div class="section">
        <label>Tipo da Planta:</label>
        <select id="tipo" onchange="atualizarCampos()">
            <option value="Caso 1">Caso 1</option>
            <option value="Caso 2">Caso 2</option>
        </select>
    </div>

    <div id="caso1" class="section" style="display: none;">
        <label>Polo:</label>
        <input type="range" id="p1_1" min="-10" max="10" step="0.1" value="-1" oninput="sincronizarValor('p1_1', 'p1_1_num', this.value)">
        <input type="number" id="p1_1_num" min="-10" max="10" step="0.1" value="-1" oninput="sincronizarValor('p1_1', 'p1_1_num', this.value)">

        <label>Zero:</label>
        <input type="range" id="z_1" min="-10" max="10" step="0.1" value="0" oninput="sincronizarValor('z_1', 'z_1_num', this.value)">
        <input type="number" id="z_1_num" min="-10" max="10" step="0.1" value="0" oninput="sincronizarValor('z_1', 'z_1_num', this.value)">
    </div>

    <div id="caso2" class="section" style="display: none;">
        <label>Polo 1:</label>
        <input type="range" id="p1_2" min="-10" max="10" step="0.1" value="-1" oninput="sincronizarValor('p1_2', 'p1_2_num', this.value)">
        <input type="number" id="p1_2_num" min="-10" max="10" step="0.1" value="-1" oninput="sincronizarValor('p1_2', 'p1_2_num', this.value)">

        <label>Polo 2:</label>
        <input type="range" id="p2_2" min="-10" max="10" step="0.1" value="-2" oninput="sincronizarValor('p2_2', 'p2_2_num', this.value)">
        <input type="number" id="p2_2_num" min="-10" max="10" step="0.1" value="-2" oninput="sincronizarValor('p2_2', 'p2_2_num', this.value)">

        <label>Zero:</label>
        <input type="range" id="z_2" min="-10" max="10" step="0.1" value="0" oninput="sincronizarValor('z_2', 'z_2_num', this.value)">
        <input type="number" id="z_2_num" min="-10" max="10" step="0.1" value="0" oninput="sincronizarValor('z_2', 'z_2_num', this.value)">
    </div>

    <div class="section">
        <h3>Par√¢metros do Controlador</h3>
        <label>Polo do Controlador:</label>
        <input type="range" id="polo_controlador" min="-10" max="10" step="0.1" value="-1" oninput="sincronizarValor('polo_controlador', 'polo_controlador_num', this.value)">
        <input type="number" id="polo_controlador_num" min="-10" max="10" step="0.1" value="-1" oninput="sincronizarValor('polo_controlador', 'polo_controlador_num', this.value)">

        <label>Zero do Controlador:</label>
        <input type="range" id="zero_controlador" min="-10" max="10" step="0.1" value="0" oninput="sincronizarValor('zero_controlador', 'zero_controlador_num', this.value)">
        <input type="number" id="zero_controlador_num" min="-10" max="10" step="0.1" value="0" oninput="sincronizarValor('zero_controlador', 'zero_controlador_num', this.value)">
    </div>

    <div class="section">
        <h3>Fun√ß√µes de Transfer√™ncia</h3>
        <div id="latex_planta" style="font-size: 1.2em; background: #eee; padding: 10px;"></div>
        <div id="latex_controlador" style="font-size: 1.2em; background: #eee; padding: 10px;"></div>
        <div id="latex_open" style="font-size: 1.2em; background: #eee; padding: 10px;"></div>
        <div id="latex_closed" style="font-size: 1.2em; background: #eee; padding: 10px;"></div>
    </div>

    <div class="section">
        <h3>Gr√°ficos</h3>
        <img id="plot" src="" style="max-width: 100%; border: 1px solid #ccc;">
        <img id="bode_plot" src="" style="max-width: 100%; border: 1px solid #ccc;">
        <img id="nyquist_plot" src="" style="max-width: 100%; border: 1px solid #ccc;">
    </div>

    <script>
        async function atualizar() {
            const tipo = document.getElementById("tipo").value;
            const data = {
                tipo,
                p1_1: document.getElementById("p1_1").value,
                z_1: document.getElementById("z_1").value,
                p1_2: document.getElementById("p1_2").value,
                p2_2: document.getElementById("p2_2").value,
                z_2: document.getElementById("z_2").value,
                polo_controlador: document.getElementById("polo_controlador").value,
                zero_controlador: document.getElementById("zero_controlador").value
            };
    
            const res = await fetch('/atualizar', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
    
            const json = await res.json();
    
            // Atualiza fun√ß√µes de transfer√™ncia
            document.getElementById("latex_planta").innerHTML = json.latex_planta;
            document.getElementById("latex_controlador").innerHTML = json.latex_controlador;
            document.getElementById("latex_open").innerHTML = json.latex_open;
            document.getElementById("latex_closed").innerHTML = json.latex_closed;
            if (window.MathJax) MathJax.typesetPromise();
    
            // Atualiza gr√°ficos
            document.getElementById("plot").src = json.plot_url;
            document.getElementById("bode_plot").src = json.bode_url;
            document.getElementById("nyquist_plot").src = json.nyquist_url;
        }
    
        function atualizarCampos() {
            const tipo = document.getElementById("tipo").value;
            document.getElementById("caso1").style.display = tipo === "Caso 1" ? "block" : "none";
            document.getElementById("caso2").style.display = tipo === "Caso 2" ? "block" : "none";
            atualizar();
        }
    
        window.onload = () => {
            atualizarCampos();
    
            // Escuta os inputs para atualizar automaticamente
            document.querySelectorAll("input").forEach(input => {
                input.addEventListener("input", atualizar);
            });
        };

        function atualizarValor(id, valor) {
            document.getElementById(id).textContent = valor;
        }

        function sincronizarValor(sliderId, numberId, valor) {
            document.getElementById(sliderId).value = valor;
            document.getElementById(numberId).value = valor;
        }
    </script>
</body>
</html>
